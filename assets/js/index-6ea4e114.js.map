{"version":3,"file":"index-6ea4e114.js","sources":["../../../src/hooks/useDownload.js","../../../src/utils/base64Conver.js","../../../src/utils/file.js","../../../src/views/able/file/index.vue"],"sourcesContent":["import { notification } from 'ant-design-vue'\r\n\r\n/**\r\n * 根据后台接口文件流下载\r\n * @param data: 接口返回的文件流 eg: Blob对象\r\n * 使用示例: downloadByData('这是一段测试文字', 'test.txt' || 'test.docx')\r\n *           downloadByData(pdfUrl, 'temp.pdf')\r\n */\r\nexport function downloadByData(data, fileName, type) {\r\n  const blob = new Blob([data], { type: type || 'application/octet-stream' })\r\n\r\n  const blobURL = window.URL.createObjectURL(blob)\r\n\r\n  const tempLink = document.createElement('a')\r\n  tempLink.style.display = 'none'\r\n  tempLink.href = blobURL\r\n  tempLink.setAttribute('download', fileName)\r\n\r\n  if (typeof tempLink.download === 'undefined') {\r\n    tempLink.setAttribute('target', '_blank')\r\n  }\r\n\r\n  document.body.appendChild(tempLink)\r\n\r\n  tempLink.click()\r\n\r\n  document.body.removeChild(tempLink)\r\n\r\n  window.URL.revokeObjectURL(blobURL)\r\n}\r\n\r\nexport async function useDownload(api, fileName, params, notify) {\r\n  if (notify) {\r\n    notification.open({\r\n      message: '温馨提示',\r\n      description: '如果数据庞大会导致下载缓慢, 请您耐心等待！',\r\n    })\r\n  }\r\n\r\n  try {\r\n    const data = await api(params)\r\n    downloadByData(data, fileName)\r\n  } catch (error) {\r\n    console.log(error)\r\n  }\r\n}\r\n","/**\r\n * img url to base64\r\n * @param url\r\n */\r\nexport function urlToBase64(url, mineType) {\r\n  return new Promise((resolve, reject) => {\r\n    let canvas = document.createElement('CANVAS')\r\n    const ctx = canvas.getContext('2d')\r\n    const img = new Image()\r\n    img.crossOrigin = ''\r\n    img.onload = function () {\r\n      if (!canvas || !ctx) {\r\n        return reject()\r\n      }\r\n      canvas.height = img.height\r\n      canvas.width = img.width\r\n      ctx.drawImage(img, 0, 0)\r\n      const dataURL = canvas.toDataURL(mineType || 'image/png')\r\n      canvas = null\r\n      resolve(dataURL)\r\n    }\r\n    img.src = url\r\n  })\r\n}\r\n\r\n/**\r\n * @description: base64 to blob\r\n */\r\nexport function dataURLtoBlob(base64Buf) {\r\n  const arr = base64Buf.split(',')\r\n  const typeItem = arr[0]\r\n  const mime = typeItem.match(/:(.*?);/)[1]\r\n  const bstr = window.atob(arr[1])\r\n  let n = bstr.length\r\n  const u8arr = new Uint8Array(n)\r\n  while (n--) {\r\n    u8arr[n] = bstr.charCodeAt(n)\r\n  }\r\n  return new Blob([u8arr], { type: mime })\r\n}\r\n","import { urlToBase64, dataURLtoBlob } from './base64Conver.js'\r\n\r\n// antd-vue 文件预览 需使用\r\nexport function getBase64(file) {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader()\r\n    reader.readAsDataURL(file)\r\n    reader.onload = () => resolve(reader.result)\r\n    reader.onerror = (error) => reject(error)\r\n  })\r\n}\r\n\r\nfunction downloadByData(data, filename, mime, bom) {\r\n  const blobData = typeof bom !== 'undefined' ? [bom, data] : [data]\r\n  const blob = new Blob(blobData, { type: mime || 'application/octet-stream' })\r\n\r\n  const blobURL = window.URL.createObjectURL(blob)\r\n  const tempLink = document.createElement('a')\r\n  tempLink.style.display = 'none'\r\n  tempLink.href = blobURL\r\n  tempLink.setAttribute('download', filename)\r\n  if (typeof tempLink.download === 'undefined') {\r\n    tempLink.setAttribute('target', '_blank')\r\n  }\r\n  document.body.appendChild(tempLink)\r\n  tempLink.click()\r\n  document.body.removeChild(tempLink)\r\n  window.URL.revokeObjectURL(blobURL)\r\n}\r\n\r\nfunction downloadByBase64(buf, filename, mime, bom) {\r\n  const base64Buf = dataURLtoBlob(buf)\r\n  downloadByData(base64Buf, filename, mime, bom)\r\n}\r\n\r\n// 下载在线图片   不会修改图片的后缀名\r\nexport function downloadByOnlineUrl(url, filename, mime, bom) {\r\n  if (!filename) {\r\n    filename = url.slice(url.lastIndexOf('/') + 1)\r\n  }\r\n\r\n  urlToBase64(url).then((base64) => {\r\n    downloadByBase64(base64, filename, mime, bom)\r\n  })\r\n}\r\n\r\n// declare type TargetContext = '_self' | '_blank'\r\n\r\n// 下载文件(在线地址)  比如: xlsx\r\nexport function downloadByUrl({ url, target = '_self', fileName }) {\r\n  const isChrome = window.navigator.userAgent.toLowerCase().indexOf('chrome') > -1\r\n  const isSafari = window.navigator.userAgent.toLowerCase().indexOf('safari') > -1\r\n\r\n  if (/(iP)/g.test(window.navigator.userAgent)) {\r\n    console.error('Your browser does not support download!')\r\n    return false\r\n  }\r\n\r\n  if (isChrome || isSafari) {\r\n    const link = document.createElement('a')\r\n    link.href = url\r\n    link.target = target\r\n\r\n    if (link.download !== undefined) {\r\n      link.download = fileName || url.substring(url.lastIndexOf('/') + 1, url.length)\r\n    }\r\n\r\n    if (document.createEvent) {\r\n      const e = document.createEvent('MouseEvents')\r\n      e.initEvent('click', true, true)\r\n      link.dispatchEvent(e)\r\n      return true\r\n    }\r\n  }\r\n\r\n  if (url.indexOf('?') === -1) {\r\n    url += '?download'\r\n  }\r\n\r\n  openWindow(url, { target })\r\n\r\n  return true\r\n}\r\n","<template>\r\n  <a-space>\r\n    <a-button type=\"primary\" @click=\"downloadPdf\">点击下载 在线Pdf</a-button>\r\n    <a-button type=\"primary\" @click=\"downloadPic\">点击下载 在线图片</a-button>\r\n    <a-button type=\"primary\" @click=\"downloadXlsx\">点击下载 在线xlsx</a-button>\r\n  </a-space>\r\n</template>\r\n\r\n<script setup>\r\nimport axios from 'axios'\r\nimport { downloadByData } from '@/hooks/useDownload'\r\nimport { downloadByOnlineUrl, downloadByUrl } from '@/utils/file'\r\n\r\n// PDF不能使用在线url直接下载, 需要接口返回流数据才能下载\r\nfunction downloadPdf() {\r\n  const testUrl =\r\n    'https://pure-admin.github.io/pure-admin-doc/pdf/Cookie%E5%92%8CSession%E5%8C%BA%E5%88%AB%E7%94%A8%E6%B3%95.pdf'\r\n\r\n  axios({\r\n    method: 'GET',\r\n    url: testUrl,\r\n    responseType: 'blob',\r\n    withCredentials: false\r\n  })\r\n    .then(res => {\r\n      const index = testUrl.lastIndexOf('.') + 1\r\n      const suffix = testUrl.substring(index)\r\n      const fileName = `文件.${suffix}`\r\n      downloadByData(res.data, fileName, res.headers['content-type'])\r\n    })\r\n    .catch(err => {\r\n      console.log('err', err)\r\n    })\r\n}\r\n\r\nfunction downloadPic() {\r\n  const testUrl = 'https://img0.baidu.com/it/u=3906269906,2494252993&fm=253&fmt=auto&app=120&f=JPEG?w=889&h=500'\r\n  downloadByOnlineUrl(testUrl, 'corgi.png')\r\n}\r\n\r\nfunction downloadXlsx() {\r\n  const testUrl = 'http://cdn.sckaiwu.cn/saas/uploads/2023-03/8bb025405df50d979b07a67ac07050ab.xlsx'\r\n  downloadByUrl({ url: testUrl })\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped></style>\r\n"],"names":["downloadByData","data","fileName","type","blob","blobURL","tempLink","urlToBase64","url","mineType","resolve","reject","canvas","ctx","img","dataURL","dataURLtoBlob","base64Buf","arr","mime","bstr","n","u8arr","filename","bom","blobData","downloadByBase64","buf","downloadByOnlineUrl","base64","downloadByUrl","target","isChrome","isSafari","link","e","downloadPdf","testUrl","axios","res","index","err","downloadPic","downloadXlsx"],"mappings":"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"}